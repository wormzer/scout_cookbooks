#!/bin/bash

set -u

echo 'Removing scout from cron'
crontab -ru <%= node[:scout][:user] %>

echo -n 'Waiting for running scout process to complete...'
while ps h -u <%= node[:scout][:user] %> > /dev/null
do
	sleep 2
	echo -n '.'
done

echo
echo 'Last report to scout has completed. Now removing host from scout.'
curl -sX DELETE https://scoutapp.com/api/v1/<%= node[:scout][:key] %>/servers?hostname="<%= node[:scout][:hostname] ? node[:scout][:hostname] : `hostname`.chop %>"

echo
echo 'Done.'

<%# vim: set ts=2 sw=2 tw=0 softtabstop=2 noet ft=sh:%>
